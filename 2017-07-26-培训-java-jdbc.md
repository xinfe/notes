*author : xinfe*    
*date : 2017-07-26*   
***
# java:JDBC           
对学生进行增删改查                  

### 一、项目结构             
![structure.PNG](https://i.loli.net/2017/07/26/597859db69792.png)          

### 二、模型——学生类              
```java
package model;

/*
 * 学生类
 * 包含字段：id,name,departmentId,majorId
 */
public class StudentModel {
    private String id;              // 学号
    private String name;            // 姓名
    private String departmentId;    // 院系
    private String majorId;         // 专业
    
    public StudentModel() {
        super();
    }

    public StudentModel(String id, String name, String departmentId, String majorId) {
        super();
        this.id = id;
        this.name = name;
        this.departmentId = departmentId;
        this.majorId = majorId;
    }

    public String getId() {
        return id;
    }
    public void setId(String id) {
        this.id = id;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public String getDepartmentId() {
        return departmentId;
    }
    public void setDepartmentId(String departmentId) {
        this.departmentId = departmentId;
    }
    public String getMajorId() {
        return majorId;
    }
    public void setMajorId(String majorId) {
        this.majorId = majorId;
    }
    
    public String toString(){
        return "学号：" + this.id +
                "\t姓名：" + this.name +
                "\t院系编号：" + this.departmentId +
                "\t专业编号：" + this.majorId;
    }
}
```


### 三、工具——连接数据库与释放数据库资源                 
```java
package util;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class DBConnection {
    private static final String URL = "jdbc:mysql://localhost:3306/sc_db";
    private static final String USER = "root";
    private static final String PASSWORD = "wxf0123";
    private static Connection conn = null;
    
    
    // 连接数据库并返回Connection对象
    public static Connection getConnection(){
        try{
            Class.forName("com.mysql.jdbc.Driver");// 加载类
            conn = DriverManager.getConnection(URL, USER, PASSWORD);// 连接数据库
        }catch(Exception e){
            e.printStackTrace();
        }
        return conn;
    }
    
    // 释放数据库资源
    public static void close(Connection conn,PreparedStatement ptmt,ResultSet rs){
        
        try {
            if(conn != null){
                conn.close();
            }
            if(ptmt != null){
                ptmt.close();
            }
            if(rs != null){
                rs.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    
}
```

### 四、DAO——操纵数据                
```java 
package dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import model.StudentModel;
import util.DBConnection;

public class StudentDao {
    
    //增
    public void insert(StudentModel studentModel){
        
        Connection conn = DBConnection.getConnection();// 连接数据库
        PreparedStatement ptmt = null;
        String sql = "insert into student(id,name,departmentId,majorId) values(?,?,?,?)";
        
        try {
            // 创建一个 PreparedStatement 对象来将参数化的 SQL 语句发送到数据库。
            ptmt = conn.prepareStatement(sql);
            
            // 传入参数
            ptmt.setString(1, studentModel.getId());
            ptmt.setString(2, studentModel.getName());
            ptmt.setString(3, studentModel.getDepartmentId());
            ptmt.setString(4, studentModel.getMajorId());
            
            // 执行
            ptmt.execute();
            
        } catch (SQLException e) {
            e.printStackTrace();
        }finally{
            
            // 释放资源
            DBConnection.close(conn, ptmt, null);
        }
    }
    
    //删(按学号删)
    public void delete(String id){
        Connection conn = DBConnection.getConnection();
        PreparedStatement ptmt = null;
        String sql = "delete from student where id=?";
        try {
            ptmt = conn.prepareStatement(sql);
            ptmt.setString(1, id);
            ptmt.execute();
        } catch (SQLException e) {
            e.printStackTrace();
        }finally{
            DBConnection.close(conn, ptmt, null);
        }
    }
    
    //改
    public void update(StudentModel studentModel){
        Connection conn = DBConnection.getConnection();
        PreparedStatement ptmt = null;
        String sql = "update student set name=?,departmentId=?,majorId=? where id=?";
        try {
            ptmt = conn.prepareStatement(sql);
            ptmt.setString(1, studentModel.getName());
            ptmt.setString(2, studentModel.getDepartmentId());
            ptmt.setString(3, studentModel.getMajorId());
            ptmt.setString(4, studentModel.getId());
            ptmt.execute();
        } catch (SQLException e) {
            e.printStackTrace();
        }finally{
            DBConnection.close(conn, ptmt, null);
        }
    }
    
    //查(查询全部)
    public List<StudentModel> selectAll(){
        Connection conn = DBConnection.getConnection();
        PreparedStatement ptmt = null;
        ResultSet rs = null;
        String sql = "select * from student";
        List<StudentModel> list = new ArrayList<StudentModel>();// 存储查询结果
        
        try {
            ptmt = conn.prepareStatement(sql);
            rs = ptmt.executeQuery();
            
            while(rs.next()){
                StudentModel studentModel = new StudentModel();
                
                studentModel.setId(rs.getString("id"));
                studentModel.setName(rs.getString("name"));
                studentModel.setDepartmentId(rs.getString("departmentId"));
                studentModel.setMajorId(rs.getString("majorId"));
                
                list.add(studentModel);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }finally{
            DBConnection.close(conn, ptmt, rs);
        }
        return list;
    }
    
    
    
    public static void main(String[] args) {
        
        StudentDao studentDao = new StudentDao();
        List<StudentModel> list = null;
        
        StudentModel sm1 = new StudentModel("001","张三","jsj","rjgc");
        StudentModel sm2 = new StudentModel("002","李四","jsj","wlgc");
        StudentModel sm3 = new StudentModel("003","王五","jsj","wlw");
        
        // 增
        studentDao.insert(sm1);
        studentDao.insert(sm2);
        studentDao.insert(sm3);
        
        // 查
        list = studentDao.selectAll();
        for(StudentModel s : list){
            System.out.println(s.toString());
        }
        
        System.out.println("=============================================================");
        
        // 删
        studentDao.delete("003");
        
        // 查
        list = studentDao.selectAll();
        for(StudentModel s : list){
            System.out.println(s.toString());
        }
        
        System.out.println("=============================================================");
        
        
        // 改
        StudentModel sm4 = new StudentModel("002","王五","jsj","wlw");
        studentDao.update(sm4);
        
        // 查
        list = studentDao.selectAll();
        for(StudentModel s : list){
            System.out.println(s.toString());
        }
        
        System.out.println("=============================================================");
    }
    
}
```

结果：          
![result.PNG](https://i.loli.net/2017/07/26/597859db44e92.png)          

### 参考              
![JDBC 使用说明 - 菜鸟教程](http://www.runoob.com/w3cnote/jdbc-use-guide.html)         
***